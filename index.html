<!DOCTYPE html>
<html>
  <head>
    <title>BBS Cryptosuite v2023</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class='remove'></script>
    <script class='remove' src="https://w3c.github.io/vc-data-integrity/common.js"></script>

    <script type="text/javascript" class="remove">
      const respecConfig = {
        // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
        specStatus:           "ED",

        // the specification's short name, as in http://www.w3.org/TR/short-name/
        shortName: "vc-di-bbs",
        subtitle: "Securing Verifiable Credentials with Selective Disclosure using BBS Signatures",
        group: "vc",
        // latestVersion: "https://www.w3.org/community/reports/credentials/CG-FINAL-vc-di-bbs-20230405/",

        // if you wish the publication date to be other than today, set this
        // publishDate:  "2023-05-18",

        // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
        // and its maturity status
        // previousPublishDate:  "1977-03-15",
        // previousMaturity:  "WD",

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI:           "https://w3c.github.io/vc-di-bbs/",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "2009-08-05",

        // if you want to have extra CSS, append them to this list
        // it is recommended that the respec.css stylesheet be kept
        //extraCSS:             ["spec.css", "prettify.css"],

        // editors, add as many as you like
        // only "name" is required
        editors:  [{
            name: "Tobias Looker", url: "https://mattr.global/",
            company: "Mattr", companyURL: "https://mattr.global/", w3cid: 109171,
          }, {
            name: "Greg Bernstein", url: "https://www.grotto-networking.com/",
            company: "Invited Expert", w3cid: 140479
          }, {
            name: "Manu Sporny", url: "https://digitalbazaar.com/",
            company: "Digital Bazaar", companyURL: "https://digitalbazaar.com/",
            w3cid: 41758
          }
        ],

        // extend the bibliography entries
        //localBiblio: webpayments.localBiblio,

        // wg:           "Verifiable Credentials Working Group Group",
        // URI of the public WG page
        // wgURI:        "https://www.w3.org/community/credentials/",
        // name (with the @w3c.org) of the public mailing to which comments are due
        // wgPublicList: "public-credentials",
        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
        // Team Contact.
        // wgPatentURI:  "https://www.w3.org/community/about/agreements/cla/",

        github: "https://github.com/w3c/vc-di-bbs",

        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
        // Team Contact.
        // wgPatentURI:  "",
        maxTocLevel: 4,
        /*preProcess: [ webpayments.preProcess ],
        alternateFormats: [ {uri: "diff-20111214.html", label: "diff to previous version"} ],
        */
        localBiblio:  {
          "RDF-DATASET-NORMALIZATION": {
            title:    "RDF Dataset Normalization 1.0",
            href:     "http://json-ld.github.io/normalization/spec/",
            authors:  ["David Longley", "Manu Sporny"],
            status:   "CGDRAFT",
            publisher:  "JSON-LD Community Group"
          },
          "RDF-CONCEPTS": {
            title:    "RDF 1.1 Concepts and Abstract Syntax",
            href:     "https://www.w3.org/TR/rdf11-concepts/",
            authors:  ["Richard Cyganiak", "David Wood", "Markus Lanthaler"],
            status:   "Recommendation",
            publisher:  "W3C"
          },
          "RDF-N-Quads": {
            title:    "RDF 1.1 N-Quads",
            href:     "http://json-ld.github.io/normalization/spec/",
            authors:  ["Gaven Carothers"],
            status:   "Recommendation",
          },
          "VC-DATA-INTEGRITY": {
            title:    "Verifiable Credential Data Integrity 1.0",
            href:     "https://www.w3.org/TR/vc-data-integrity/",
            authors:  ["David Longley", "Manu Sporny"],
            status:   "Working Draft",
            publisher:  "W3C Verifiable Credentials Working Group"
          },
          "JSON-LD-FRAMING": {
            title:    "JSON-LD 1.1 Framing",
            href:     "https://www.w3.org/TR/json-ld11-framing",
            authors:  ["Dave Longley", "Gregg Kellogg", "Pierre-Antoine Champin"],
            status:   "Candidate Recommendation",
            publisher:  "W3C"
          },
          "JSON-LD": {
            title:    "JSON-LD 1.1",
            href:     "https://www.w3.org/TR/json-ld11",
            authors:  ["Dave Longley", "Gregg Kellogg", "Pierre-Antoine Champin"],
            status:   "Candidate Recommendation",
            publisher:  "W3C"
          },
          "VC-DATA-MODEL-2": {
            title: "Verifiable Credentials Data Model v2.0",
            href: "https://www.w3.org/TR/vc-data-model-2.0/",
            authors: [
              "Manu Sporny", "Dave Longley", "Grant Noble", "Dan Burnett",
              "Ted Thibodeau", "Brent Zundel", "David Chadwick",
              "Kyle Den Hartog"
            ],
            status: "Working Draft",
            publisher: "W3C Verifiable Credentials Working Group"
          },
          MULTIBASE: {
            title: "Multibase",
            href: "https://tools.ietf.org/html/draft-multiformats-multibase-01",
          },
          MULTICODEC: {
            title: "Multicodec",
            href: "https://github.com/multiformats/multicodec/",
          },
          "CFRG-BBS-SIGNATURE": {
            title:    "The BBS Signature Scheme",
            href:     "https://www.ietf.org/archive/id/draft-irtf-cfrg-bbs-signatures-02.html",
            authors:  ["Tobias Looker", "Vasilis Kalos", "Andrew Whitehead", "Mike Lodder"],
            status:   "Draft"
          },
          "BLS-JOSE-COSE": {
            title:    "Barreto-Lynn-Scott Elliptic Curve Key Representations for JOSE and COSE",
            href:     "https://datatracker.ietf.org/doc/draft-ietf-cose-bls-key-representations/",
            authors:  ["Michael B. Jones", "Tobias Looker"],
            status:   "Draft"
          }
        },
        lint: {"no-unused-dfns": false},
        postProcess: [restrictRefs]
      };
    </script>
        <style>
          pre .highlight {
            font-weight: bold;
            color: green;
          }
          pre .comment {
            font-weight: bold;
            color: Gray;
          }
          .color-text {
            font-weight: bold;
            text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
          }
          ol.algorithm {
            counter-reset: numsection;
            list-style-type: none;
          }
          ol.algorithm li {
            margin: 0.5em 0;
          }
          ol.algorithm li:before {
            font-weight: bold;
            counter-increment: numsection;
            content: counters(numsection, ".") ") ";
          }
              </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
This specification describes a Data Integrity Cryptosuite for use when generating
digital signatures using the BBS signature scheme.
The Signature Suite utilizes BBS signatures to provide selective disclosur and
unlinkable derived proofs.
      </p>
    </section>

    <section id='sotd'>
      <p>
This is an experimental specification and is undergoing regular revisions. It
is not fit for production deployment.
      </p>
    </section>

    <section>
      <h2>Introduction</h2>
      <p>
This specification defines a cryptographic suite for the purpose of
creating, verifying and deriving proofs using the BBS Signature Scheme in
conformance with the Data Integrity [[VC-DATA-INTEGRITY]] specification. The
BBS signature scheme directly provides for selective disclosure and unlinkable
proofs. It provides four high level functions that work within the issuer,
holder, verifier model. In particular an issuer uses the BBS `Sign` function to
create a cryptographic value known as a "BBS signature" which is used in signing
the original credential. A holder, on receipt of
a credential signed with BBS, then verifies the credential with the BBS `Verify`
function.
      </p>
      <p>
The holder then chooses information to selectively disclose from the
received credential and uses the BBS `ProofGen` function to generate a
cryptographic value, known as a "BBS proof" which is used in creating a proof
for this "derived credential". The cryptographic "BBS proof" value is unlinkable
to the original "BBS signature" and a different, unlinkable "BBS proof" can be
generated by the holder for additional "derived credentials", including those
containing the exact same information.
Finally, a verifier uses the BBS `ProofVerify` function to verify the derived
credential received from the holder.
      </p>
      <p>
To apply the BBS signature scheme to verifiable credentials involves the
processing specified in this document.
In general the suite uses the RDF Dataset Normalization Algorithm
[[RDF-DATASET-NORMALIZATION]] to transform an input document into its canonical
form. An issuer then uses selective disclosure primitives to separate the
canonical form into mandatory and non-mandatory statements. These are processed
separately with other information to serve as the inputs to the BBS `Sign`
function along with appropriate key material. This output is used to
generate a secured credential. A holder uses a set of selective disclosure
functions and the BBS `Verify` function on receipt of the credential
to ascertain validity.
      </p>
      <p>
Similarly, a holder on receipt of a BBS signed credential uses the RDF Dataset
Normalization Algorithm [[RDF-DATASET-NORMALIZATION]] to transform an input
document into its canonical form  and then applies selective disclosure
primitives to separate the canonical form into mandatory and selectively
disclosed statements which are appropriately processed and serve as inputs to
the BBS `ProofGen` function. The output of this function suitably processed
becomes the signed selectively disclosed credential sent to a verifier. Using
canonicalization and selective disclosure primitives the verifier can then use
the BBS `verifyProof` function to validate the credential.
      </p>

      <section id="terminology">
        <h3>Terminology</h3>

        <div data-include="https://w3c.github.io/vc-data-integrity/terms.html"></div>

      </section>


      <section id="conformance">

      <p class="issue">TODO: Add paragraph</p>

      </section>
    </section>

    <section>
      <h2>Data Model</h2>

      <p>
The following sections outline the data model that is used by this specification
for <a>verification methods</a> and <a>data integrity proof</a> formats.
      </p>

      <section>
        <h2>Verification Methods</h2>
        <p>
The cryptographic material used to verify a <a>data integrity proof</a> is
called the <a>verification method</a>. This suite relies on public key material
represented using [[MULTIBASE]], [[MULTICODEC]], JSON Web Key [[RFC7517]], and [[BLS-JOSE-COSE]].
        </p>

        <p>
This suite MAY be used to verify Data Integrity Proofs [[VC-DATA-INTEGRITY]]
produced by BLS12-381 public key material encoded as a
<a href="#jsonwebkey">JsonWebKey</a>. Loss-less key transformation processes that
result in equivalent cryptographic material MAY be utilized.
        </p>

        <section>
          <h3>Multikey</h3>

          <p class="issue">
This definition should go in the Data Integrity specification and referenced
from there.
          </p>

          <p>
The `type` of the verification method MUST be `Multikey`.
          </p>

          <p>
The `controller` of the verification method MUST be a URL.
          </p>

          <p>
The `publicKeyMultibase` property of the verification method MUST be a public
key encoded according to [[MULTICODEC]] and formatted according to
[[MULTIBASE]]. The multicodec encoding of a BLS12-381 public key that combines
both the G1 and G2 fields is the byte prefix `0xee` followed by the 48-byte G1
public key data, which is then followed by the 96-byte G2 public key data. The
145 byte value is then encoded using base64url with no padding (`u`) as the
prefix. Any other encodings MUST NOT be used.
          </p>

          <p class="advisement">
Developers are advised to not accidentally publish a representation of a private
key. Implementations of this specification will raise errors in the event of a
[[MULTICODEC]] value other than `0xee` being used in a `publicKeyMultibase`
value.
          </p>

          <pre class="example"
            title="An BLS12-381 public key containing the G1 and G2 values, encoded as a Multikey">
{
  "id": "https://example.com/issuer/123#key-0",
  "type": "Multikey",
  "controller": "https://example.com/issuer/123",
  "publicKeyMultibase": "u7ljnAxKdp7YVqJvcMU9GtnmrMc1XZztXHsTsZ2LsmGJ67SsdbmNc
    S2SDs0daEPfhVXgODk0IVrgguJ-TJACHyXYa9Ae8DaxcvRy89KLgmWsyOOJn2oY7vCE2gt
    JoebMJiQsdbmNcS2SDs0daEPfhVXgODk0IVrgguJ-TJACHyXYa9Ae8DaxcvRy89KLgm"
}
          </pre>

          <pre class="example" title="A BLS12-381 public key containing the
            G1 and G2 values, encoded as a Multikey in a controller document">
{
  "@context": [
    "https://www.w3.org/ns/did/v1",
    "https://w3id.org/security/data-integrity/v1"
  ],
  "id": "https://example.com/issuer/123",
  "verificationMethod": [{
    "id": "https://example.com/issuer/123#key-1",
    "type": "Multikey",
    "controller": "https://example.com/issuer/123",
    "publicKeyMultibase": "u7ljnAxKdp7YVqJvcMU9GtnmrMc1XZztXHsTsZ2LsmGJ67SsdbmNc
      S2SDs0daEPfhVXgODk0IVrgguJ-TJACHyXYa9Ae8DaxcvRy89KLgmWsyOOJn2oY7vCE2gt
      JoebMJiQsdbmNcS2SDs0daEPfhVXgODk0IVrgguJ-TJACHyXYa9Ae8DaxcvRy89KLgm"
  }]
}
          </pre>
        </section>
      </section>
    <section>
      <h2>Data Integrity Proof</h2>

      <section>
        <h3>bbs-signature-2023</h3>
<p>
  This suite relies on detached digital signatures represented using [[MULTIBASE]].
</p>

        <p>
The `verificationMethod` property of the proof MUST be a URL.
Dereferencing the `verificationMethod` MUST result in an object
containing a `type` property with the value set to
`Multikey` or `JsonWebKey`.
        </p>

        <p>
The `type` property of the proof MUST be `DataIntegrityProof`.
        </p>
        <p>
The `cryptosuite` property of the proof MUST be `bbs-signature-2023`.
        </p>
        <p>
The `created` property of the proof MUST be an [[XMLSCHEMA11-2]]
formated date string.
        </p>
        <p>
The `proofPurpose` property of the proof MUST be a string, and MUST
match the verification relationship expressed by the verification method
`controller`.
        </p>
        <p>
The `proofValue` property of the proof MUST be a detached BBS Signature
produced according to <a data-cite="CFRG-BBS-SIGNATURE#name-sign">Sign</a>, encoded according to
[[MULTIBASE]] using the base64 base encoding with no padding.
        </p>

        <pre class="example highlight" style="overflow-x:
          auto; white-space: pre-wrap; word-wrap: break-word;"
          title="An BBS digital signature expressed as a DataIntegrityProof">
{
  "@context": [
    {"title": "https://schema.org/title"},
    "https://w3id.org/security/data-integrity/v1"
  ],
  "title": "Hello world!",
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "bbs-signature-2023",
    "created": "2020-11-05T19:23:24Z",
    "verificationMethod": "https://example.com/issuer/123#key-2",
    "proofPurpose": "assertionMethod",
    "proofValue": "uU6i3dTz5yFfWJ8zgsamuyZa4yAHPm75tUOOXddR6krCvCYk77sbCOuEVcdB
      Dd/l6tIYkTTbA3pmDa6Qia/JkOnIXDLmoBz3vsi7L5t3DWySI/VLmBqleJ/Tbus5RoyiDERDB
      5rnACXlnOqJ/U8yFQFtcp/mBCc2FtKNPHae9jKIv1dm9K9QK1F3GI1AwyGoUfjLWrkGDObO1o
      AhpEd0+et+qiOf2j8p3MTTtRRx4Hgjcl0jXCq7C7R5/nLpgimHAAAAdAx4ouhMk7v9dXijCIM
      0deicn6fLoq3GcNHuH5X1j22LU/hDu7vvPnk/6JLkZ1xQAAAAIPd1tu598L/K3NSy0zOy6oba
      Enaqc1R5Ih/6ZZgfEln2a6tuUp4wePExI1DGHqwj3j2lKg31a/6bSs7SMecHBQdgIYHnBmCYG
      nu/LZ9TFV56tBXY6YOWZgFzgLDrApnrFpixEACM9rwrJ5ORtxAAAAAgE4gUIIC9aHyJNa5TBk
      Oh6ojlvQkMVLXa/vEl+3NCLXblxjgpM7UEMqBkE9/aGQcoD3Tgmy+z0hN+4elMky1RnJEhCuN
      QNsEg"
  }
}
        </pre>

      </section>
      <section>
        <h3>bbs-proof-2023</h3>
<p>
  This suite relies on detached digital signatures represented using [[MULTIBASE]].
</p>

        <p>
The `verificationMethod` property of the proof MUST be a URL.
Dereferencing the `verificationMethod` MUST result in an object
containing a `type` property with the value set to
`Multikey` or `JsonWebKey`.
        </p>

        <p>
The `type` property of the proof MUST be `DataIntegrityProof`.
        </p>
        <p>
The `cryptosuite` property of the proof MUST be `bbs-proof-2023`.
        </p>
        <p>
The `created` property of the proof MUST be an [[XMLSCHEMA11-2]]
formated date string.
        </p>
        <p>
The `proofPurpose` property of the proof MUST be a string, and MUST
match the verification relationship expressed by the verification method
`controller`.
        </p>
        <p>
The `proofValue` property of the proof MUST be a detached BBS Signature
produced according to <a data-cite="CFRG-BBS-SIGNATURE#name-proofgen">ProofGen</a>,
encoded according to [[MULTIBASE]] using the base64 base encoding with no padding.
        </p>

        <pre class="example highlight" style="overflow-x:
          auto; white-space: pre-wrap; word-wrap: break-word;"
          title="An BBS zero-knowledge proof-of-knowledge of a signature expressed as a DataIntegrityProof">
{
  "@context": [
    {"title": "https://schema.org/title"},
    "https://w3id.org/security/data-integrity/v1"
  ],
  "title": "Hello world!",
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "bbs-proof-2023",
    "created": "2020-11-05T19:23:24Z",
    "verificationMethod": "https://example.com/issuer/123#key-2",
    "proofPurpose": "assertionMethod",
    "generators": 3,
    "disclosed": [ 2 ],
    "proofValue": "uU6i3dTz5yFfWJ8zgsamuyZa4yAHPm75tUOOXddR6krCvCYk77sbCOuEVcdB
      Dd/l6tIYkTTbA3pmDa6Qia/JkOnIXDLmoBz3vsi7L5t3DWySI/VLmBqleJ/Tbus5RoyiDERDB
      5rnACXlnOqJ/U8yFQFtcp/mBCc2FtKNPHae9jKIv1dm9K9QK1F3GI1AwyGoUfjLWrkGDObO1o
      AhpEd0+et+qiOf2j8p3MTTtRRx4Hgjcl0jXCq7C7R5/nLpgimHAAAAdAx4ouhMk7v9dXijCIM
      0deicn6fLoq3GcNHuH5X1j22LU/hDu7vvPnk/6JLkZ1xQAAAAIPd1tu598L/K3NSy0zOy6oba
      Enaqc1R5Ih/6ZZgfEln2a6tuUp4wePExI1DGHqwj3j2lKg31a/6bSs7SMecHBQdgIYHnBmCYG
      nu/LZ9TFV56tBXY6YOWZgFzgLDrApnrFpixEACM9rwrJ5ORtxAAAAAgE4gUIIC9aHyJNa5TBk
      Oh6ojlvQkMVLXa/vEl+3NCLXblxjgpM7UEMqBkE9/aGQcoD3Tgmy+z0hN+4elMky1RnJEhCuN
      QNsEg"
  }
}
        </pre>

      </section>
    </section>
  </section>
</section>

  <section>
    <h2>Algorithms</h2>

    <p>
The following section describes multiple Data Integrity cryptographic suites
that utilize the BBS Signature Algorithm [[CFRG-BBS-SIGNATURE]].
    </p>

    <section>
    <h3>bbs-signature-2023</h3>

    <p>
The `bbs-signature-2023` cryptographic suite takes an input document, canonicalizes
the document using the Universal RDF Dataset Canonicalization Algorithm
[[RDF-CANON]], and then cryptographically hashes and signs the output
resulting in the production of a data integrity proof. The algorithms in this
section also include the verification of such a data integrity proof.
    </p>

    <section>
      <h2>Add Proof </h2>

      <p>
To generate a proof, the algorithm in
<a href="https://www.w3.org/TR/vc-data-integrity/#add-proof">
Section 4.1: Add Proof</a> in the Data Integrity
[[VC-DATA-INTEGRITY]] specification MUST be executed.
For that algorithm, the cryptographic suite specific
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-transformation-algorithm">
transformation algorithm</a> is defined in Section
<a href="#transformation-bbs-signature-2023"></a>, the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-hashing-algorithm">
hashing algorithm</a> is defined in Section <a href="#hashing-bbs-signature-2023"></a>,
and the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-proof-serialization-algorithm">
proof serialization algorithm</a> is defined in Section
<a href="#proof-serialization-bbs-signature-2023"></a>.
      </p>
    </section>

    <section>
      <h2>Verify Proof </h2>

      <p>
To verify a proof, the algorithm in
<a href="https://www.w3.org/TR/vc-data-integrity/#verify-proof">
Section 4.2: Verify Proof</a> in the Data Integrity
[[VC-DATA-INTEGRITY]] specification MUST be executed.
For that algorithm, the cryptographic suite specific
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-transformation-algorithm">
transformation algorithm</a> is defined in Section
<a href="#transformation-bbs-signature-2023"></a>, the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-hashing-algorithm">
hashing algorithm</a> is defined in Section <a href="#hashing-bbs-signature-2023"></a>,
and the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-proof-serialization-algorithm">
proof verification algorithm</a> is defined in Section
<a href="#proof-verification-bbs-signature-2023"></a>.
      </p>
    </section>

    <section id="transformation-bbs-signature-2023">
      <h3>Transformation </h3>

      <p>
The following algorithm specifies how to transform an unsecured input document
into a transformed document that is ready to be provided as input to the
hashing algorithm in Section <a href="#hashing-bbs-signature-2023"></a>.
      </p>


Required inputs to this algorithm are an
unsecured data document (<code>unsecuredDocument</code>) and
<a data-cite="VC-DATA-INTEGRITY#transformations">
transformation options</a> (<code>options</code>). The
transformation options MUST contain a type identifier for the
<a data-cite="VC-DATA-INTEGRITY#cryptographic-suites">
cryptographic suite</a> (<code>type</code>) and a cryptosuite
identifier (<code>cryptosuite</code>). A <em>transformed data document</em> is
produced as output. Whenever this algorithm encodes strings, it MUST use UTF-8
encoding.
      </p>

      <ol class="algorithm">
        <li>
If <code>options</code>.<code>type</code> is not set to the string
`DataIntegrityProof` and <code>options</code>.<code>cryptosuite</code> is not
set to the string `bbs-signature-2023` then a `PROOF_TRANSFORMATION_ERROR` MUST be
raised.
        </li>
        <li>
Let <code>canonicalDocument</code> be the result of applying the
Universal RDF Dataset Canonicalization Algorithm
[[RDF-CANON]] to the <code>unsecuredDocument</code>.
        </li>
        <li>
Set <code>output</code> to the value of <code>canonicalDocument</code>.
        </li>
        <li>
Return <code>canonicalDocument</code> as the <em>transformed data document</em>.
        </li>
      </ol>
    </section>

    <section id="hashing-bbs-signature-2023">
      <h3>Hashing </h3>

      <p>
The following algorithm specifies how to cryptographically hash a
<em>transformed data document</em> and <em>proof configuration</em>
into cryptographic hash data that is ready to be provided as input to the
algorithms in Section <a href="#proof-serialization-bbs-signature-2023"></a> or
Section <a href="#proof-verification-bbs-signature-2023"></a>.
      </p>

      <p>
The required inputs to this algorithm are a <em>transformed data document</em>
(<code>transformedDocument</code>) and <em>proof configuration</em>
(<code>proofConfig</code>). A single <em>hash data</em> value represented as
series of bytes is produced as output.
      </p>

      <ol class="algorithm">
        <li >
<p class="issue">
  Specify how each item in the canonicalized input is hashed and included a set
that is then signed over in <a href="#proof-serialization-bbs-signature-2023"></a>.
</p>
        </li>
        <li>
<p class="issue">
  Specify how <code>proofConfigHash</code> is generated.
</p>

        </li>
        <li >
<p class="issue">
  Specify how <code>hashData</code> is composed in a way that can be signed over in
  <a href="#proof-serialization-bbs-signature-2023"></a>.
</p>

        </li>
        <li>
Return <code>hashData</code> as the <em>hash data</em>.
        </li>
      </ol>

    </section>

    <section>
      <h3>Proof Configuration </h3>

      <p>
The following algorithm specifies how to generate a
<em>proof configuration</em> from a set of <em>proof options</em>
that is used as input to the <a href="#hashing-bbs-signature-2023">proof hashing algorithm</a>.
      </p>

      <p>
The required inputs to this algorithm are <em>proof options</em>
(<code>options</code>). The <em>proof options</em> MUST contain a type identifier
for the
<a data-cite="VC-DATA-INTEGRITY#cryptographic-suites">
cryptographic suite</a> (<code>type</code>) and MUST contain a cryptosuite
identifier (<code>cryptosuite</code>). A <em>proof configuration</em>
object is produced as output.
      </p>

      <ol class="algorithm">
        <li>
Let <code>proofConfig</code> be an empty object.
        </li>
        <li>
Set <code>proofConfig</code>.<code>type</code> to
<code>options</code>.<code>type</code>.
        </li>
        <li>
If <code>options</code>.<code>cryptosuite</code> is set, set
<code>proofConfig</code>.<code>cryptosuite</code> to its value.
        </li>
        <li>
If <code>options</code>.<code>type</code> is not set to `DataIntegrityProof` and
<code>proofConfig</code>.<code>cryptosuite</code> is not set to `bbs-signature-2023`, an
`INVALID_PROOF_CONFIGURATION` error MUST be raised.
        </li>
        <li>
Set <code>proofConfig</code>.<code>created</code> to
<code>options</code>.<code>created</code>. If the value is not a valid
[[XMLSCHEMA11-2]] datetime, an `INVALID_PROOF_DATETIME` error MUST be raised.
        </li>
        <li>
Set <code>proofConfig</code>.<code>verificationMethod</code> to
<code>options</code>.<code>verificationMethod</code>.
        </li>
        <li>
Set <code>proofConfig</code>.<code>proofPurpose</code> to
<code>options</code>.<code>proofPurpose</code>.
        </li>
        <li>
Return <code>proofConfig</code>.
        </li>
      </ol>

    </section>

    <section id="proof-serialization-bbs-signature-2023">
      <h3>Proof Serialization </h3>

      <p>
The following algorithm specifies how to serialize a digital signature from
a set of cryptographic hash data. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [[VC-DATA-INTEGRITY]] specification,
<a data-cite="VC-DATA-INTEGRITY#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<code>hashData</code>) and
<em>proof options</em> (<code>options</code>). The
<em>proof options</em> MUST contain a type identifier for the
<a data-cte="VC-DATA-INTEGRITY#cryptographic-suites">
cryptographic suite</a> (<code>type</code>) and MAY contain a cryptosuite
identifier (<code>cryptosuite</code>). A single <em>digital proof</em> value
represented as series of bytes is produced as output.
      </p>

      <ol class="algorithm">
        <li>
Let <code>privateKeyBytes</code> be the result of retrieving the
private key bytes associated with the
<code>options</code>.<code>verificationMethod</code> value as described in the
Data Integrity [[VC-DATA-INTEGRITY]] specification.
        </li>
        <li >
<p class="issue">
  Specify how <code>proofBytes</code> is generated and consumed by Section
<a href="#proof-verification-bbs-signature-2023"></a>.
</p>
        </li>
        <li>
Return <code>proofBytes</code> as the <em>digital proof</em>.
        </li>
      </ol>

    </section>

    <section id="proof-verification-bbs-signature-2023">
      <h3>Proof Verification </h3>

      <p>
The following algorithm specifies how to verify a digital signature from
a set of cryptographic hash data. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [[VC-DATA-INTEGRITY]] specification,
<a data-cite="VC-DATA-INTEGRITY#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<code>hashData</code>),
a digital signature (<code>proofBytes</code>) and
proof options (<code>options</code>). A <em>verification result</em>
represented as a boolean value is produced as output.
      </p>

      <ol class="algorithm">
        <li>
Let <code>publicKeyBytes</code> be the result of retrieving the
public key bytes associated with the
<code>options</code>.<code>verificationMethod</code> value as described in the
Data Integrity [[VC-DATA-INTEGRITY]] specification,
<a data-cite="VC-DATA-INTEGRITY#algorithms">
Section 4: Retrieving Cryptographic Material</a>.
        </li>
        <li>
Let <code>verificationResult</code> be the result of applying the verification
algorithm defined in the BBS Signature specification [[CFRG-BBS-SIGNATURE]],
with <code>hashData</code> as the data to be verified against the
<code>proofBytes</code> using the public key specified by
<code>publicKeyBytes</code>.
        </li>
        <li>
Return <code>verificationResult</code> as the <em>verification result</em>.
        </li>
      </ol>

    </section>
  </section>
  <section>
    <h3>bbs-proof-2023</h3>
    <p>
      The `bbs-proof-2023` cryptographic suite takes an input document,
      that has previously been secured using `bbs-signature-2023`,
      derives from this original document a set of messages to be disclosed
      representing a redacted form of the original document, and
      applies the <a data-cite="CFRG-BBS-SIGNATURE#name-proofgen">Proof Gen</a>
      algorithm to produce a proof of knowledge for the disclosed messages.
      The result is a new `proof`, containing the following attributes:
    </p>


    <ul>
      <li>
        `generators`
      </li>
      <li>
        `disclosed`
      </li>
      <li>
        `proofValue`
      </li>
    </ul>
    <p>This operation can be applied by any
      <a data-cite="VC-DATA-MODEL-2#dfn-holders">holder</a> of a `bbs-signature-2023`
      secured document, and as such, `bbs-proof-2023` MUST be implemented with
      awareness of the mandatory to disclose fields the original
      <a data-cite="VC-DATA-MODEL-2#dfn-issuers">issuer</a> required.
    </p>
    <p class="issue" data-number="3"></p>
    <section>
      <h3>Add Proof </h3>
      <p class="issue" data-number="81"></p>
    </section>
    <section>
      <h3>Verify Proof </h3>
      <p class="issue" data-number="82"></p>
    </section>
    <section>
      <h3>Transformation </h3>
      <p class="issue" data-number="83"></p>
    </section>
    <section>
      <h3>Hashing </h3>
      <p class="issue" data-number="84"></p>
    </section>
    <section>
      <h3>Proof Configuration </h3>
      <p class="issue" data-number="85"></p>
    </section>
    <section>
      <h3>Proof Serialization </h3>
      <p class="issue" data-number="85"></p>
    </section>
    <section>
      <h3>Proof Verification </h3>
      <p class="issue" data-number="85"></p>
    </section>

  </section>
</section>



<section>
  <h2>Privacy Considerations</h2>
  <p class="issue">TODO: We need to add a complete list of privacy
  considerations.</p>
</section>

<section>
  <h2>Security Considerations</h2>
  <p class="issue">TODO: We need to add a complete list of security
  considerations.</p>
</section>



    <section class="appendix">
      <h2>Acknowledgements</h2>
      <p>
        Portions of the work on this specification have been funded by the
        United States Department of Homeland Security's (US DHS) Silicon Valley
        Innovation Program under contracts
        70RSAT20T00000003,
        and
        70RSAT20T00000033.
        The content of this specification does not
        necessarily reflect the position or the policy of the U.S. Government
        and no official endorsement should be inferred.
      </p>
    </section>
  </body>
</html>
